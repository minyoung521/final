<!DOCTYPE html>
<html>
{% load static %}
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <title>게시글 상세보기</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="Free HTML5 Website Template by freehtml5.co" />
   <meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
   <meta name="author" content="freehtml5.co" />

   <!-- Facebook and Twitter integration -->
   <meta property="og:title" content=""/>
   <meta property="og:image" content=""/>
   <meta property="og:url" content=""/>
   <meta property="og:site_name" content=""/>
   <meta property="og:description" content=""/>
   <meta name="twitter:title" content="" />
   <meta name="twitter:image" content="" />
   <meta name="twitter:url" content="" />
   <meta name="twitter:card" content="" />

   <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
   <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400" rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

   <!-- Animate.css -->
   <link rel="stylesheet" href="{% static 'css/animate.css' %}">
   <!-- Icomoon Icon Fonts-->
   <link rel="stylesheet" href="{% static 'css/icomoon.css' %}">
   <!-- Bootstrap  -->
   <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
   <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

   <!-- Magnific Popup -->
   <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">

   <!-- Owl Carousel  -->
   <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
   <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">

   <!-- Flexslider  -->
   <link rel="stylesheet" href="{% static 'css/flexslider.css' %}">

   <!-- Pricing -->
   <link rel="stylesheet" href="{% static 'css/pricing.css' %}">

   <!-- Theme style  -->
   <link rel="stylesheet" href="{% static 'css/style.css' %}">

   <!-- Modernizr JS -->
   <script src="{% static 'js/modernizr-2.6.2.min.js' %}"></script>
   <!-- FOR IE9 below -->
   <!--[if lt IE 9]>
   <script src="{% static 'js/respond.min.js' %}"></script>
   <![endif]-->

   <style>
   .comment-section {
       margin-top: 2rem;
       padding-top: 2rem;
       border-top: 1px solid #e9ecef;
   }
   .comment-item {
       background-color: #f8f9fa;
       border: 1px solid #e9ecef;
       border-radius: 8px;
       padding: 15px;
       margin-bottom: 15px;
   }
   .comment-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-bottom: 10px;
   }
   .comment-author {
       font-weight: bold;
       color: #495057;
   }
   .comment-date {
       font-size: 0.85rem;
       color: #6c757d;
   }
   .comment-content {
       margin-bottom: 10px;
       line-height: 1.6;
   }
   .comment-actions {
       text-align: right;
   }
   .comment-form {
       background-color: #f8f9fa;
       padding: 20px;
       border-radius: 8px;
       margin-bottom: 20px;
   }
   .btn-delete {
       background-color: #dc3545;
       color: white;
       border: none;
       padding: 5px 10px;
       border-radius: 4px;
       font-size: 0.8rem;
   }
   .btn-delete:hover {
       background-color: #c82333;
   }
   </style>
</head>

<body>
   <div id="page">
    <nav class="fh5co-nav" role="navigation">
      <div class="top">
         <div class="container">
            <div class="row">
               <div class="col-xs-12 text-right">
                  <p class="site"></p>
                  <p class="num">Call: +01 123 456 7890</p>
                  <ul class="fh5co-social">
                     <li><a href="#"><i class="icon-facebook2"></i></a></li>
                     <li><a href="#"><i class="icon-twitter2"></i></a></li>
                     <li><a href="#"><i class="icon-dribbble2"></i></a></li>
                     <li><a href="#"><i class="icon-github"></i></a></li>
                  </ul>
               </div>
            </div>
         </div>
      </div>

      <div class="top-menu">
         <div class="container">
            <div class="row">
               <div class="col-xs-2">
                  <div id="fh5co-logo"><a href="{% url 'web:home' %}"><i class="icon-study"></i>돔고돔락<span></span></a></div>
               </div>
               <div class="col-xs-10 text-right menu-1">
                  <ul>
                     <li><a href="{% url 'web:home' %}">홈페이지</a></li>
                     <li class="has-dropdown">
                        <a href="{% url 'web:guide' %}">생활관 안내</a>
                        <ul class="dropdown">
                           {% if user.is_authenticated %}
                           <li><a href="{% url 'web:check_in' %}">입실 신청</a></li>
                           <li><a href="{% url 'web:outside' %}">외박 신청</a></li>
                           <li><a href="{% url 'web:info' %}">생활관 안내</a></li>
                           <li><a href="{% url 'web:rules' %}">생활관 규칙</a></li>
                           {% else %}
                           <li><a href="" onclick="alert('로그인이 필요한 페이지입니다.'); window.location.href='{% url 'web:login' %}'; return false;">입실 신청</a></li>
                           <li><a href="" onclick="alert('로그인이 필요한 페이지입니다.'); window.location.href='{% url 'web:login' %}'; return false;">외박 신청</a></li>
                           <li><a href="{% url 'web:info' %}">생활관 안내</a></li>
                           <li><a href="{% url 'web:rules' %}">생활관 규칙</a></li>
                           {% endif %}
                        </ul>
                     </li>
                     <li class="has-dropdown">
                        <a href="{% url 'web:community' %}">커뮤니티</a>
                        <ul class="dropdown">
                           {% if user.is_authenticated %}
                           <li><a href="{% url 'web:notice' %}">공지 사항</a></li>
                           <li><a href="{% url 'web:community_home' %}">자유 게시판</a></li>
                           {% else %}
                           <li><a href="" onclick="alert('로그인이 필요한 페이지입니다.'); window.location.href='{% url 'web:login' %}'; return false;">공지 사항</a></li>
                           <li><a href="" onclick="alert('로그인이 필요한 페이지입니다.'); window.location.href='{% url 'web:login' %}'; return false;">자유 게시판</a></li>
                           {% endif %}
                        </ul>
                     </li>
                     <li class="has-dropdown">
                        {% if user.is_authenticated %}
                           <a href="{% url 'web:mypage' %}">마이페이지</a>
                        {% else %}
                           <a href="" onclick="alert('로그인이 필요한 페이지입니다.'); window.location.href='{% url 'web:login' %}'; return false;">마이페이지</a>
                        {% endif %}
                     </li>
                     {% if user.is_authenticated %}
                    <li class="btn-cta" style="margin-right: 10px;">
                       <span class="btn-cta">{{ user.userprofile.full_name|default:user.username }}님, 환영합니다!</span>
                    </li>
                    <li class="btn-cta">
                       <form method="post" action="{% url 'web:logout' %}" style="display: inline;">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-link p-0" style="text-decoration: none; color: blue;">
                             로그아웃
                          </button>
                       </form>
                    </li>
                    {% else %}
                    <li class="btn-cta">
                       <a href="{% url 'web:login' %}"><span>로그인</span></a>
                    </li>
                    {% endif %}

                  </ul>
               </div>
            </div>
         </div>
      </div>
   </nav>

   <div class="container mt-5">
       <div class="bg-secondary bg-opacity-10 p-4 rounded shadow-sm">
           <div class="post-content">
               <h2>{{ post.title }}</h2>
               <p class="text-end mb-3"><strong>작성일:</strong> {{ post.created_at|date:"Y-m-d H:i" }}</p>
               <hr class="border-dark">
               <p>{{ post.content|linebreaks }}</p>
               {% if post.image %}
               <div class="text-center mt-3">
                   <img src="{{ post.image.url }}" alt="게시글 이미지" class="img-fluid" style="max-width: 100%; height: auto;">
               </div>
               {% endif %}


                <div class="d-flex justify-content-between align-items-center mt-4">
                    <div class="d-flex justify-content-between align-items-center mt-4">
                      <h5 class="mb-0">
                         <i class="fas fa-heart"></i> 좋아요 수
                        <span class="badge bg-light text-dark"> {{ post.likes.count }}</span>
                      </h5>
                      <form method="post" action="{% url 'web:toggle_like' post.id %}">
                        {% csrf_token %}
                        {% if user.is_authenticated %}
                          <button type="submit" class="btn {% if user in post.likes.all %}btn-danger{% else %}btn-outline-danger{% endif %}">
                            <i class="fas fa-heart"></i> 좋아요 누르기
                          </button>
                        {% else %}
                          <a href="{% url 'web:login' %}" class="btn btn-outline-secondary">
                            로그인 후 좋아요
                          </a>
                        {% endif %}
                      </form>
                    </div>
                  <div>
                    <a href="{% url 'web:community_home' %}" class="btn btn-secondary">목록으로</a>
                    {% if user.is_authenticated and user == post.author %}
                      <a href="{% url 'web:community_update' post.id %}" class="btn btn-primary ms-2">수정하기</a>
                    {% endif %}
                  </div>
                </div>
           </div>
       </div>

       <!-- 댓글 섹션 -->
       <div class="comment-section">
           <h4><i class="fas fa-comments"></i> 댓글 <span class="badge bg-secondary">{{ comments.count }}</span></h4>

           <!-- 댓글 작성 폼 -->
           {% if user.is_authenticated %}
           <div class="comment-form">
               <form method="post" action="{% url 'web:add_comment' post.pk %}">
                   {% csrf_token %}
                   <div class="mb-3">
                       <label class="form-label">댓글 작성</label>
                       {{ comment_form.content }}
                   </div>
                   <button type="submit" class="btn btn-primary">
                       <i class="fas fa-paper-plane"></i> 댓글 등록
                   </button>
               </form>
           </div>
           {% else %}
           <div class="alert alert-info">
               <i class="fas fa-info-circle"></i> 댓글을 작성하려면 <a href="{% url 'web:login' %}">로그인</a>이 필요합니다.
           </div>
           {% endif %}

           <!-- 댓글 목록 -->
           <div class="comments-list">
               {% for comment in comments %}
               <div class="comment-item">
                   <div class="comment-header">
                       <div class="comment-author">
                           <i class="fas fa-user-circle"></i> 익명{{ forloop.counter }}
                       </div>
                       <div class="comment-date">
                           {{ comment.created_at|date:"Y-m-d H:i" }}
                       </div>
                   </div>
                   <div class="comment-content">
                       {{ comment.content|linebreaks }}
                   </div>
                   {% if user.is_authenticated and user == comment.author or user.is_staff %}
                   <div class="comment-actions">
                       <form method="post" action="{% url 'web:delete_comment' comment.id %}" style="display: inline;"
                             onsubmit="return confirm('정말로 이 댓글을 삭제하시겠습니까?');">
                           {% csrf_token %}
                           <button type="submit" class="btn-delete">
                               <i class="fas fa-trash"></i> 삭제
                           </button>
                       </form>
                   </div>
                   {% endif %}
               </div>
               {% empty %}
               <div class="alert alert-light text-center">
                   <i class="fas fa-comment-slash"></i> 등록된 댓글이 없습니다.
               </div>
               {% endfor %}
           </div>
       </div>
   </div>

   <!-- Bootstrap JS -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

   <!-- Messages -->
   {% if messages %}
   <script>
       {% for message in messages %}
       alert('{{ message }}');
       {% endfor %}
   </script>
   {% endif %}

   <script>
    document.addEventListener("DOMContentLoaded", function () {
      const textarea = document.getElementById("comment-textarea");
      if (!textarea) return;
      const form = textarea.closest("form");

      textarea.addEventListener("keydown", function (event) {
        if (event.key === "Enter" && !event.shiftKey) {
          event.preventDefault();
          form.submit();
        }
      });
    });
  </script>
</div>
</body>
</html>